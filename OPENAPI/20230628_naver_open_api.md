# Open API 란?

## 오픈 API 개요

오픈 API란 서비스를 제공하는 업체에서 외부 개발자가 자사 서비스의 기능을 간단히 호출해
이용할 수 있도록 공개해둔 API를 말합니다. 자사의 서비스를 다른 업체의 앱이나 서비스에서도
제공하게 하여 사용자를 늘리고 영향력을 확대하는 것이 주된 목적으로, 수많은 인터넷 업체가
서비스 일부를 앞다투어 오픈 API로 제공하고 있습니다.
주로 HTTP 프로토콜로 통신하며, 응답 데이터의 형태는 JSON 포맷을 가장 많이 씁니다.
과거에는 XML을 많이 이용했지만 JSON이 더 가볍고 사람이 읽기에도 편하며,
무엇보다 웹 프로그래밍의 표준 언어 격인 자바스크립트에서 바로 읽고 쓸수 있어
많은 웹개발자들이 활용하고 있습니다.

### 네이버 검색 API를 활용한 검색 결과출력하기

동적 웹 프로젝트 생성 및 라이브러리 설치

 1) SEVENTH_JSP 이름으로 동적 웹 프로젝트 생성 -
     프로젝트 클릭 선택 - Properties - Java Build Path - Libraries - Add Library
     - Server Runtime 에서 Apache Tomcat v9.0선택 추가

 2) SEVENTH_JSP 프로젝트 클릭 - 우클릭 - Properties
    - Web Project Settings 에서 Context root: 입력란에 기존 "SEVENTH_JSP"를 "/"로 변경해 주기 바랍니다.

 3) Tomcat 서버 Modules 설정에서 Path 설정을 기존 "/SEVENTH_JSP"에서 "/" 변경 처리 후 저장합니다.

네이버 검색 API를 활용하여 우리가 만든 웹 애플리케이션에 블로그 검색 결과를
한 페이지에 10개씩 출력되도록 구현하겠습니다.

보통 네이버, 카카오, 페이스북과 같은 인터넷 기업은 물론 수많은 공공기관에서도 자사의
서비스나 데이터를 오픈 API로 제공하는데，다행히도 이용 방법이 대체로 비슷합니다.
그래서 하나의 방법을 익혀두시면, 최소한의 노력으로 다채로운 서비스와 연동하여
웹 사이트 서비스를 다양하게 구현할 수 있습니다.

### JSON 기초

네이버 검색 API는 검색 결과를 XML이나 JSON으로 반환합니다.
우리는 JSON을 사용할 것이며, JSON은 JavaScript Object Notation의 약자로,
자바스크립트에서 객체나 배열을 만들 때 사용하는 표현 방식입니다.
작성하기 쉽고 용랑을 적게 차지해서 XML을 대체하는 데이터 전송 및 저장 수단으로 많이 쓰입니다.

JSON의 형식에는 다음과 같이 모두 4가지가 있습니다. 중괄호 { }는 객체를 뜻하고,
대괄호 [ ]는 배열을 뜻합니다.

① '객체'는 키(key)와 값(value)로 구분합니다.
객체 { }

```
{	
  "name": "장나라", "age":21, "address": "서울시 마포구 상암동"
}
```

② '배열'은 값만으로 구성
배열 [ ]

```
[ 
   "Java", "Oracle", "HTML5", "JSP", "JavaScript"
]
```

③ 객체의 값으로 배열을 사용
객체 { }, 배열 [ ]

```
{
  "firstName": "Nara", "lastName": "Jang",
  "Citys": ["SEOUL", "BUSAN", "ULSAN", "DAEGU"]
}
```

④ 배열의 값으로 객체를사용
배열 [ ], 객체{ }

```
[ 
   {"City" : "서울", "HotPlace" : "이태원"},
   {"City" : "부산", "HotPlace" : "해운대"},
   {"City" : "대구", "HotPlace" : "향촌동"}
]
```

JSON은 위의 4가지 기본 형식을 조합하여 아주 복잡한 데이터까지 표현할 수 있습니다.


### 검색 결과 출력 프로세스 분석

우리는 네이버 검색 API를 활용해서 블로그를 검색하는 프로젝트를 진행합니다.

[전체 구성 : 검색 결과 출력 프로세스]

    검색 화면          검색 요청         서블릿          API 호출          
(SearchView.jsp)          →	       SearchAPl.java       →        네이버 검색 API
                              ←            결과 출력           ←
                                                                결과 반환	

검색 결과 출력 프로세스 비교적 간단합니다. 우리는 네이버가 제공하는 API에 맞게 요청을 하고,
결과를 받아 처리하기만 하면 됩니다. API 내부가 어떻게 동작하는지는 전혀 신경 쓸 필요가
없습니다. 오픈 API를 이용하면 이처럼 간단하게 세련된 기능을 내 어플리케이션에 추가할수 있습니다.
물론 오픈 API를 이용하려면 먼저 서비스 업체의 허락을 얻어야 합니다. 따라서 먼저 API 이용신청
방법부터 알아본 후, API 사용설명서를 살펴본 다음, 마지막으로 코드를 구현해 보겠습니다.

3) 오픈 API 이용 신청
네이버 검색 API를 사용하려면 먼저 네이버 개발자센터에서 이용 신청을 해야 합니다.

1단계) 네이버(https://naver.com)에 접속하여 본인 계정으로 '로그인’합니다.

2단계) 네이버 검색창에서 “네이버 개발자센터”를 검색합니다.

3단계) 검색 결과에서 “네이버 개발자센터” 링크를 클릭합니다. 
         "네이버 개발자 센터" 링크 URL 
         https://developers.naver.com/main/ 

4단계) 검색용 오픈 API를 이용해야 하므로 [Products] - [검색] 메뉴를 클릭합니다.

5단계) 화면을 아래로 스크롤하여 [오픈 API 이용 신청] 버튼을 클릭합니다.
[참고] 네이버 개발자센터를 처음 이용한다면 ‘오픈 API 이용약관 동의’ 과정을 거치게 됩니다.
        네이버의 안내에 따라 약관에 동의하면 곧바로 다음 단계（애플리케이션 등록）로 진행됩니다.

6단계) [애플리케이션 등록] 페이지에서는 아래와 같이 입력합니다.
         •	애플리케이션이름 : 원하는 이름을 입력합니다.
         •	사용 API : '검색'을 선택합니다.
         •	환경 추가 : WEB 설정
         •  웹 서비스 URL : (예시) http://localhost:8080
URL을 올바로 입력하면 입력란이 녹색으로 바뀌고, [등록하기] 버튼이 활성화됩니다.

7단계) [등록하기]를 클릭하여 등록을 완료합니다. 등록이 완료되면 [내 애플리케이션]에
         방금 등록한 항목이 추가됩니다.

8단계) [Client ID]와 [Client Secret] 항목의 값을 메모장에 기록해 둡니다.
        검색 API를 사용하기 위해 발급된 키(Key) 입니다.
[참고] 발급받은 키는 상단 "Application" - 하단 "내 애플리케이션"에서 다시 확인할 수 있습니다.

이제, 검색 API를사용하기 위한 신청이 완료되었습니다.

4) API 문서 살펴보기
[Documents] 탭으로 이동하여 API 문서를 확인해보겠습니다. 검색 API에 대한 설명은
[Documents] - [검색] 메뉴를 클릭하면 확인할수 있습니다.
검색 API 설명 화면은 왼쪽에 있는 검색 대상을 선택하면 오른쪽에 상세 설명이 나타납니다.

상세 설명은 다시 'API 호출 예제', '준비사항', 'API 기본 정보', '요청 변수', '출력 결과',
'에러 코드', '예시' 등의 세부 항목으로 나뉩니다. 화면을 아쾌로 스크롤하면 모두 확인하실 수 있습니다.

가장 처음에는 ‘API 호출 예제’가 언어별로 나오는데, 우리는 그중 Java 예제를 서블릿으로 복사해
사용할 것이기 때문에 기억해 두시기 바랍니다.
세부 항목 중 곧 구현해볼 코드를 이해하는 데 필요한 'API 기본 정보'와 '요청 변수' 부분만
더 살 펴보겠습니다. 'API 기본 정보' 항목은 HTTP 메서드(GET 혹은 POST), 인증 필요 여부,
요청 URL, 출력 포맷을 알려줍니다.

앞서 원하는 출력 포맷이 XML인지 또는 JSON인지에 따라서 요청 URL이 달라짐을 확인할 수 있습니다.
우리는 JSON을 이용할 것이므로 두 번째 요청 URL을 이용할 것입니다. JSON이 기본값이기 때문에
끝의 "Json"은 생략해도 됩니다.

다음은 '요청 변수' 항목을 보겠습니다.
요청 변수란 요청 URL에 쿼리스트링으로 덧붙일 수 있는 변수를 말합니다.
검색 키워드를 뜻하는 query는 필수 항목이며, 나머지는 선택입니다.
변수별로 기본값을 확인해보고, 원하는 값과 다르면 값을 명시해주면 됩니다.
우리는 결과를 페이지 단위로 보여줄 것이 display와 start 변수를 추가할 것입니다.
그리고, 세부 항목 중 '출력 결과'와 '에러 코드' 항목은 참고만 하시기 바랍니다.

5) 서블릿 구현
검색 서블릿의 뼈대를 만든 후 API 설명 문서의 호출 예제를 복사해 우리에게 맞게
수정해보겠습니다. 먼저 api 패키지에 SearchAPI라는 이름으로 서블릿 템플릿을 작성합니다.

[중요] 검색 결과 확인
1단계) 이클립스에서 톰켓 서버를 재시작합니다.
2단계) 웹브라우저에서 다음 주소에 접속합니다.
         •	http://localhost:9001/NaverSearchAPI.do
        처음에는 검색 키워드 등 필요한 매개변수가 없어서 500 에러가 발생합니다.
3단계) 다음처럼 매개변수를 추가해 다시 접속합니다.
         •	http://localhost:9001/NaverSearchAPI.do?keyword=강남역맛집&startNum=1

검색 결과가 JSON으로 출력 되는 것을 확인합니다. 필드들의 의미는 다음과 같습니다.
[다음]
{
  "lastBuildDate": "…",      ← 검색 결과를 생성한 시간
  "total": "...",                ← 검색 결과 문서의 총 개수
  "start": "...",                ← 검색 결과 문서 중, 문서의 시작점
  "display": "...",             ← 검색된 검색 결과 중 문서에 출력된 개수
  "items"： [                 ← 검색 결과 목록
  {                             ← 개별 검색 결과로, 반복해서 출력됨
  "title": "...",                ← 검색 결과 문서의 제목 
  "link": "...",                 ←  검색 결과 문서의 하이퍼텍스트 링크
  "description": "...",       ←  검색 결과 문서의 내용을 요약한 정보
  "bloggername"："...",   ←  블로거의 이름
  "bloggerlink": "...",      ←  블로그 포스트를 작성한 블로거의 하이퍼텍스트 링크
  "postdate": "...",         ←  블로그 포스트를 작성한 날짜
  },
  ... 항목 반복 ...
}

items 항목을 보면 JSON의 4가지 형식 중 3번인 '객체의 값으로 배열을 사용'한 형식입니다.
그런데 그 배열의 요소로 다시 객체를 사용하고 있습니다. 이처럼 JSON은 4가지 형식을 얼마든지
조합하고 중첩하여 복잡한 데이터까지 표현할 수 있습니다.
[참고] JAVA Servelt 구동시 인증에 실패했다는 오류가 뜨면 SearchAPl.java 코드에서
        clientld, clientSecret 값을 수정하지 않은 것입니다. 수정 후 다시 구동 바랍니다.


6) 검색 결과를 웹 브라우저에 출력
API 호출 결과로 받은 JSON을 파싱하여 웹 브라우저에 출력할 차례입니다.
동작 절차는 다음과 같습니다.
▼ 검색 결과 출력 상세 프로세스
	검색 화면 (SearchView.jsp)
	한페이지에 10개씩 노출됨                        →      서블릿         →    네이버
	페이지 : 검색어 입력       [검색 요청 버튼]      (SearchAPI.java)  ←    검색API
	검색 결과가 노출되는 텍스트 필드 구성

1단계) JSP에서는 먼저 검색어를 입력한후 [검색 요청] 버튼을클릭하면
2단계) Ajax 메서드를 통해 비동기 방식으로 서블릿으로 전송합니다.
3단계) 그런 다음 서블릿이 네이버 검색 API를 호출해 네이버에서 검색 결과를
         JSON으로 반환하면
4단계) 서블릿에서 직접 출력합니다.
5단계) JSP는 이 내용을 콜백 메서드에서 받은 후 파싱하여 웹 브라우저에 출력하면 됩니다.

먼저 검색을 요청하고 결과를 출력해줄 화면을 JSP로 만들어봅니다.
코드가 길어서 UI 요소를 구성하는 코드부터 본 후 자바스크립트 코드는 뒤이어 살펴보겠습니다.

[중요]
$.each( ) 메서드는 다음과 같이 두 가지 형식으로 사용합니다.
① 형식1 : DOM 요소를 선택한후 반복 실행합니다.
1. $('선택자').each(function(index, item) {
    // 선택한 요소의 반복 실행 문장;
   }
   [위 코드 설명]
   $('선택자') = 1. DOM 선택 후 반복
   index = 2. 반복 요소의 인덱스(0부터 시작)
   item = 3. 반복 요소의 데이터

② 형식 2 : 배열을 첫 번째 인수로 받아 반복 실행합니다.

2. $.each(배열, function(index, item) {
   // 배열 요소의 반복 실행 문장;
   }
   [위 코드 설명]
   배열 = 1. 배열
   index = 2. 배열 요소의 인덱스(0부터 시작)
   item = 3. 배열 요소의 데이터

7) 동작 확인
   1단계) SearchView.jsp 를 실행합니다.
   2단계) 검색어 입력란에 검색어를 입력한후 [검색 요청] 버튼을 클릭 합니다.
            그러면 잠시 후 검색 결과가 출력되는 것을 볼 수 있습니다.
            화면을 스크롤해보면 총 10개가 보일 것입니다.
   3단계) 페이지 선택란에서 “2페이지”를 선택 후 검색하면 11번째부터의 검색 결과를
            볼 수 있습니다.

2. 종합 정리
   네이버는 검색 외에도 '파파고 번역', '클로바 얼굴 인식' 등 다양한 기능을 오픈 API로 제공하고 있습니다.
   익숙해지면 공공 API, 카카오, 구글, 페이스북 등을 활용해 볼 수 있습니다.

3. 주요 내용 요약
   1) 오픈 API를 사용하려면 API 제공자로부터 권한을 얻어야 합니다. 네이버는 '네이버 개발자센터'에서
      오픈 API 이용 신청을 받습니다.
   2) 오픈 API 사용 전에 API 문서를 참고하도록하자.
   3) 대다수 오픈 API가 데이터를 주고 받는 표준 포맷으로 JSON을 이용합니다.
       JSON 활용법을 알아야 한다.
   4) 오픈 API를 통해 얻어오는 JSON 데이터를 뷰에 적용하기 위해서는 비동기 통신이 필수이므로
       Ajax와 같은 메서드 사용법도 알아야 한다.
