# 커스텀 태그 만들기

스크립트 요소가 많아지면 많아질수록 JSP 코드는 복잡해집니다.
이런 문제점을 해결하는 방법 중에서 한 가지는 커스텀 태그를 사용하는 것입니다.
앞서 커스텀 태그의 일종인 JSTL을 사용하면 코드의 복잡함을 줄일 수 있습니다.
JSTL과 같은 커스텀 태그를 구현하는 방법으로 태그 파일의 작성 방법에 대해서 알아봅니다.

1. 커스텀 태그
JSP는 새로운 태그를 만들어서 사용할 수 있도록 지원하고 있는데, 이렇게 원하는 목적에 맞게
작성한 태그를 커스텀 태그(Custom Tag)라고 부릅니다. 앞서 JSTL도 커스텀 태그의 일종으로,
JSTL은 다수의 웹 어플리케이션에서 필요로 하는 커스텀 태그를 모아 놓은 커스텀 태그 라이브러리입니다.

1) 커스텀 태그의 장점
커스텀 태그를 사용해서 얻을 수 있는 장점은 다음과 같습니다.
• 재사용성 : 한 번 작성한 커스텀 태그는 어떤 JSP 컨테이너에서도 사용 가능합니다.
• 쉽고 단순한 JSP 코드 작성 : 자바 코드에 익숙하지 않은 개발자들도 커스텀 태그를 사용하면
                                     쉽게 JSP 페이지를 작성할 수 있게 됩니다.
• 코드 가독성 향상 : 커스텀 태그는 뚜렷한 의도를 갖고, 커스텀 태그를 사용하면 스크립트 코드를
                         줄일 수 있기 때문에 JSP 코드의 가독성을 높일 수 있습니다.
                         커스텀 태그를 사용하면 개발자와 함께 JSP 코드를 봐야 하는 UI 개발자가
                         코드를 이해하는 데 도움이 됩니다. 복잡한 스크립트 코드 대신 이해하기 쉬운
                         태그 형태의 코드를 사용해서 UI 개발자도 약간의 교육만으로 JSP 코드를 보고
                         수정 작업을 할 수 있기 때문입니다.

2. 커스텀 태그의 종류
커스텀 태그를 구현하는 방법에는 다음과 같이 3가지 종류가 있습니다.
① JSP 1.2 스타일로 구현한 커스텀 태그
② JSP 2.0 또는 그 이상 버전의 SimpleTag를 사용한 커스텀 태그
③ JSP 2.0 또는 그 이상 버전의 태그 파일을 사용한 커스텀 태그
위의 세 가지 방식 중에서 ① JSP 1.2 방식의 커스텀 태그와
② SimpleTag를 이용한 커스텀 태그는 자바 기반의 커스텀 태그로서
자바 개발자가 구현하기에 적합한 방식입니다. 이들 구현 방식은
주로 커스텀 태그의 표준 인터페이스를 구현하거나 클래스를 상속받아서 구현합니다.
③ 태그 파일은 JSP와 유사한 방식으로 커스텀 태그를 구현하며,
서블릿 대신 JSP로 구현하듯 커스텀 태그 클래스를 커스텀 태그 파일로 구현할 수 있습니다.

우리는 위에 세 가지 구현 방식 중에서 구현이 어렵지 않고 빠르게 개발할 수 있는
③ 태그 파일에 대해서 알아보도록 하겠습니다.

3. 이클립스 프로젝트 생성
1) [File] - [New] - [Dynamic Web Project] 메뉴를 실행합니다.

2) New Dynamic Web Project 대화창에서 다음과 같이 설정 후
   [Finish] 버튼을 클릭해서 프로젝트를 생성합니다.
   a. Project name : CUSTOM_TAG
   b. Target runtime : Apache Tomcat v9.0
   (톰켓 런타임을 다른 이름으로 등록했다면 해당 이름 사용)
   c. Dynamic web module version : 3.1

3) 프로젝트 생성 후 jstl-1.2.jar 파일을 WebContent/WEB-INF/lib 폴더에 복사합니다.

4) 프로젝트 클릭 - 우클릭 - Properties
    - Web Project Settings 에서 Context root: 입력란에 기존 "GUEST_BOOK"를 "/"로 변경해 주기 바랍니다.

5) Tomcat 서버 Modules 설정에서 Path 설정을 기존 "/GUEST_BOOK"에서 "/" 변경 처리 후 저장합니다.

6) 프로젝트 클릭 선택 - Properties - Java Build Path - Libraries - Add Library
   - Server Runtime 에서 Apache Tomcat v9.0 선택 추가 바랍니다.

4. 태그 파일을 이용한 커스팀 태그 구현
태그 파일이 출현하기 전까지 커스텀 태그를 구현하려면 정해진 규칙대로
자바 코드를 작성하고, 컴파일해서 클래스 파일을 만들고,
TLD 파일을 작성하고, web.xml 파일에 TLD 관련 정보를 기술해야 했습니다.
이는 자바에 익숙하지 않은 웹 개발자가 커스텀 태그를 구현하고
테스트하는 것을 어렵게 만들었습니다. 이런 어려움을 없애기 위해 추가된 것이 태그 파일입니다.
서블릿의 복잡한 구현 과정을 JSP가 쉽게 처리해주는 것처럼,
커스텀 태그 클래스를 만들기 위한 복잡한 과정을 커스텀 태그 파일이 쉽게 처리해 줍니다.

태그 파일을 간단히 정의하면 다음과 같습니다.
[다음]
"JSP 문법을 사용해서 커스텀 태그로 동작할수 있도록 만들어진 소스 코드"
즉, JSP 페이지를 작성하듯이 태그 파일을 만들 수 있고,
JSP 페이지에서는 커스텀 태그를 사용하는 것과 동일한 방법으로 태그 파일을 사용할 수 있습니다.

1) 태그 파일의 기본
태그 파일은 JSP 페이지와 동일한 문법을 사용합니다.
JSP 페이지를 작성하듯이 태그 파일을 작성하면 됩니다.
또한, 웹 컨테이너가 JSP 소스 코드를 서블릿 클래스로 변환해주듯
이 태그 파일도 커스텀 태그 클래스로 변환합니다.

JSP 페이지는 page, taglib, include 등 다양한 디렉티브를 사용할 수 있는데,
태그 파일도 JSP 페이지에서 사용하는 몇 가지 디렉터브와 태그 파일을 위한
디렉터브를 사용할 수 있습니다.

다음은 태그 파일에서 사용할 수 있는 디렉터브를 정리한 것입니다.

[다음]

디렉티브	                                         의미
   tag	    JSP 페이지의 page 디렉티브와 동일합니다.
                page 디렉티브가 JSP 페이지에 대한 설정 정보 등을 명시하는 것처럼
                tag 디렉티브는 태그 파일의 정보를 명시합니다.
  taglib	    태그 파일에서 사용할 태그 라이브러리를 명시할 때 사용합니다.
                사용법은 JSP 페이지와 동일합니다.
  include	     JSP 페이지와 마찬가지로 태그 파일에 특정한 파일을 포함시킬 때 사용합니다.
                 단, 태그 파일에 포함되는 파일은 태그 파일에 알맞은 문법으로 작성되어야 합니다.
 attribute     태그 파일을 커스텀 태그로 사용할 때 입력받을 속성을 명시합니다.
  variable	     EL 변수로 사용할 변수에 대한 정보를 지정합니다.

==================================================================

tag 디렉터브는 태그 파일과 관련된 설정 정보를 포함하며,
다음과 같은 사용 가능 기본 객체를 제공합니다.

• jspContext : pageContext가 제공하는 setAttribute(),
  getAttribute() 메서드를 그대로 제공하며, 각 속성과 관련된 작업을 처리합니다.
• request : JSP 페이지의 request 기본 객체와 동일합니다.
• response : JSP 페이지의 response 기본 객체와 동일합니다..
• session : JSP 페이지의 session 기본 객체와 동일합니다.
• application : JSP 페이지의 application 기본 객체와 동일합니다.
• out : JSP 페이지의 out 기본 객체와 동일합니다.
태그 파일은 JSP 페이지와 마찬가지로 이들 기본 객체를 사용해서
원하는 정보를 얻고 알맞은 작업을 수행할 수 있습니다.

2) 내용을 출력하는 단순 태그 파일 구현
먼저 단순히 내용을 출력하는 태그 파일을 작성해 봅니다.
여기서 작성할 태그 파일은 커스텀 태그 위치에 현재 시간을 출력하는 기능을 제공합니다.
JSP 페이지에서 현재 시간을 출력하는 코드를 태그 파일에서 그대로 사용하면 됩니다.

* 1단계 : TAG 소스 코딩 : WebContenVWEB-INF/tags/now.tag

* 2단계 : JSP 소스 코딩 : WebContent/now.jsp

5. 태그 파일의 속성 설정 방법
JSTL의 <c:if> 태그나 <c:forEach> 태그를 보면 test, var, items 등의 속성을 이용해서
태그를 실행하는 데 필요한 값을 전달 받습니다. 태그 파일도 속성을 이용해서
태그 파일을 실행하는 데 필요한 값을 전달 받습니다.
태그 파일은 attribute 디렉터브를 사용해서 속성 정보를 설정합니다.
attribute 디렉티브는 커스텀 태그가 허용하는 속성에 대한 정보를 설정합니다.
attribute 디렉티브의 속성은 다음과 같습니다.

[다음 : attribute 디렉티브의 속성]
     속성	                            의미
 description         속성에 대한 설명을 입력합니다. (선택)

    name	           속성의 이름을 입력합니다. 태그 파일 내에서
                       스크립트 변수나 EL 변수의 이름으로 사용됩니다.
                       각 attribute 디렉티브의 name 속성값은 서로 달라야 합니다.
                       name 속성값이 tag 디렉터브의 dynamic-attributes 속성값과 같거나
                       variable 디렉티브의 name-given 속성값과 같으면 에러가 발생합니다. (필수)

  required           속성의 필수 여부를 지정합니다.
                       필수일 경우 true, 아닌 경우 false를 값으로 지정합니다. 기본값은 false입니다. (선택)

  rtexprvalue	속성값으로 표현식을 사용할 수 있는지 여부를 지정합니다. 기본값은 true입니다. (선택)
(runtime expression value : 값이 웹 페이지의 실행 중에 결정된다는 것을 의미함)

    type	            속성값의 타입을 명시합니다. int, long, char 등의 기본 데이터 타입은 명시할 수 없으며
                        대신 java.lang.lnterger와 같은 래퍼 타입을 사용합니다. 기본값은 java.lang.String 입니다. (선택)

 fragment	<jsp:attribute> 액션 태그로 속성값을 전달할 때 이 값을 true로 지정합니다.
                         fragment 속성값을 true로 지정하면 rtexprvalue 속성은 true가 되고
                         type 속성의 값은 javax.servlet.jsp.tagext.JspFragment가 됩니다. (선택)

[속성값을 전달하는 기본 방식]
속성을 전달받아 사용하는 간단한 태그 파일을 작성해 봅니다. 작성할 태그는 다음과 같이
title 속성과 level 속성을 통해서 제목과 제목 레벨 정보를 입력받아 알맞은 헤드 태그를
출력하는 기능을 제공합니다.

* 1단계 : TAG 소스 코딩 : WebContent/WEB-INF/tags/header.tag

* 2단계 : JSP 소스 코딩 : WebContent/use_header.jsp
